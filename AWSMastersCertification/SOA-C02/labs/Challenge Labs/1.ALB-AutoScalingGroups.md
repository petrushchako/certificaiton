# Configure an Application Load Balancer and Auto Scaling Group

![](../../img/ChallengeLab-1.png)

### ABOUT THIS LAB
Application Load Balancers (ALB) are a critical component in modern scalable infrastructures. In this lab, we will walk through the process to create security groups, launch configurations, Auto Scaling groups, an Application Load Balancer, and a target tracking scaling policy.

<br>

## Objectives
- Create a Security Group for the ALB Permitting HTTP from Anywhere
- Configure a Security Group for EC2 Instances
- Configure a Launch Template
- Create an Internet-Facing ALB
- Configure an Auto Scaling Group

<br>

## Solution
## Create a Security Group for the ALB Permitting HTTP from Anywhere
1. Navigate to **EC2**.
2. In the sidebar menu, navigate to `Network & Security` and select `Security Groups`.
3. On the right, click `Create security group`.
4. Fill in the `LabALB` security group details:
    - **Security group name**: In the text field, enter `LabALB`.
    - **Description**: In the text field, enter `LabALB`.
    - **VPC**: Leave the default VPC selected.
5. In the `Inbound rules` section, click `Add rule`.
6. Fill in the rule details:
    - **Type**: Use the dropdown to select `HTTP`.
    - **Source**: In the search field, select `0.0.0.0/0`.
7. Click `Create security group`.

<br>

## Create a Security Group for EC2 Instances
1. Use the breadcrumb along the top of the page to select `Security Groups`.
2. On the right, click `Create security group`.
3. Fill in the `LabEC2` security group details:
    - **Security group name**: In the text field, enter `LabEC2`.
    - **Description**: In the text field, enter `LabEC2`.
    - **VPC**: Leave the default VPC selected.
4. In the `Inbound rules` section, click `Add rule`.
5. Fill in the rule details:
    - **Type**: Use the dropdown to select `HTTP`.
    - **Source**: In the search field, select the `LabALB` security group.
6. Click `Create security group`.

<br>

## Configure a Launch Template
1. In the sidebar menu, navigate to **Auto Scaling** and select `Launch Templates`.
2. On the right, click `Create launch template`.
3. Fill in the Launch template name and description details:
    - **Launch template name**: In the text field, enter `ALBLaunchTemplate`.
    - **Template version description**: In the text field, enter `ALBLaunchTemplate`.
    - **Auto Scaling guidance**: Check the `Provide guidance to help me set up a template that I can use with EC2 Auto Scaling` checkbox.
4. In the **Application and OS Images** section, select `Amazon Linux` and ensure the `Amazon Linux 2` AMI is selected.
5. In the **Instance type** section, use the dropdown to select `t3.micro`.
6. Fill in the Network settings details:
    - **Firewall (security groups)**: Ensure that `Select existing security group` is selected.
    - **Security groups**: Use the dropdown to select the `LabEC2` security group.
7. Expand the **Advanced details** section and scroll down to the **User data** field.
8. In the **User data** field, paste the following bootstrap script:

    ```sh
    #!/bin/bash
    yum update -y
    yum install -y httpd
    systemctl start httpd
    systemctl enable httpd
    usermod -a -G apache ec2-user
    chown -R ec2-user:apache /var/www
    chmod 2775 /var/www
    cd /var/www/html
    echo "Welcome to your public facing webpage" > index.html
    ```

9. On the right, click `Create launch template`.
10. After the launch template is successfully created, click `View launch templates` and note that your template is now available.

<br>

## Create an Internet-Facing ALB
1. In the sidebar menu, navigate to **Load Balancing** and select `Load Balancers`.
2. On the right, click `Create load balancer`.
3. Below **Application Load Balancer**, click `Create`.
4. In the **Load balancer name** field, enter `LabALB`.<br>Leave the other Basic configuration options as the defaults (Internet-facing should be select for the Schema and IPv4 should be selected for the IP address type).
5. Fill in the Network mapping details:
    - **VPC**: Use the dropdown to select the `A Cloud Guru VPC`.
    - **Mappings**: Check the checkboxes for both the `us-east-1a` and `us-east-1b` Availability Zones.
6. Configure the Security groups details:
    - Click `X` to remove the default security group.
    - Use the **Security groups dropdown** to select the `LabALB` security group.
7. In the Listeners and routing section, click `Create target group`.<br>The EC2 Management Console automatically opens in a new browser tab.
8. Configure the group details for your target group:
    - **Choose a target type**: Ensure that `Instances` is selected.
    - **Target group name**: In the text field, enter `LabTargetGroup`.
    - **Health check path**: In the text field, enter `/index.html`.
9. Leave all the other default values and click `Next`.
10. Leave the Register targets page blank and click `Create target group`.
11. Navigate back to the **Load balancers** tab and click the `Refresh` button in the **Listeners and routing** section.
12. Use the Default action dropdown to select `LabTargetGroup`.
13. Scroll down to the Summary section and review your load balancer configuration.
14. Click `Create load balancer`.
15. After the load balancer is successfully created, click View load balancer and note that your load balancer is provisioning.<br>After a moment, your load balancer should become active.
