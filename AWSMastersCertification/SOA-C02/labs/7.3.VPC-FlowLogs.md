# Working with AWS VPC Flow Logs for Network Monitoring

<br>

### ABOUT THIS LAB
Monitoring network traffic is a critical component of security best practices to meet compliance requirements, investigate security incidents, track key metrics, and configure automated notifications. AWS VPC Flow Logs captures information about the IP traffic going to and from network interfaces in your VPC. In this hands-on lab, we will set up and use VPC Flow Logs published to Amazon CloudWatch, create custom metrics and alerts based on the CloudWatch logs to understand trends and receive notifications for potential security issues, and use Amazon Athena to query and analyze VPC flow logs stored in S3.

<br>

![](../img/7.3.LabDiagram.png)

<br>

### Objectives
- Create a CloudWatch Log Group and a VPC Flow Log to CloudWatch
- Create CloudWatch Filters and Alerts
- Use CloudWatch Logs Insights
- Analyze VPC Flow Logs Data in Athena

<br><br>

## Solution
## Create a CloudWatch Log Group and VPC Flow Logs to CloudWatch
### Create a VPC Flow Log to S3
1. Navigate to VPC.
2. In the VPC dashboard, select the VPCs card.<br>You should see an A Cloud Guru VPC pre-provisioned for the lab.
3. Check the checkbox next to the A Cloud Guru VPC.
4. Toward the bottom of the screen, select the Flow logs tab.
5. On the right, click Create flow log.
6. Fill in the flow log details:
    - Name: You can leave this field blank.
    - Filter: Ensure that All is selected.
    - Maximum aggregation interval: Select 1 minute.
    - Destination: Select Send to an Amazon S3 bucket.
7. Get the S3 bucket ARN:
    - In a new browser tab, navigate to S3.
    - Select the radio button next to the provided bucket.
    - Click Copy ARN.
8. Navigate back to the VPC Management Console tab and fill in the rest of the flow log details:
    - S3 bucket ARN: In the text field, paste your copied S3 bucket ARN.
    - Log record format: Ensure that AWS default format is selected.
9. Leave the other fields as the default settings and click Create flow log.<br>Your flow log is created.
10. From the Your VPCs page, select the Flow logs tab.
11. Review the flow log details and verify that it shows an Active status.
12. Navigate back to the S3 Management Console tab.
13. Select your bucket name, and then select the Permissions tab.
14. Review the bucket policy and note that it is modified automatically by AWS when you create flow logs so that the flow logs can write to the bucket.
    > Note: It can take between 5â€“15 minutes for flow logs to appear. You can continue working through the other lab objectives while you wait for the flow logs to populate.
