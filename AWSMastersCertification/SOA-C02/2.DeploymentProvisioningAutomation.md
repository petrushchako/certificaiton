# CHAPTER 2<br>**Deployment, Provisioning, and Automation**

### Chapter outline
- Section Introduction
- `Demo` Deploying an Elastic Compute Cloud (EC2) Instance
- `HANDS-ON LAB` Create and Secure an EC2 Instance
- Understanding EBS Volumes
- What Is a Bastion Host?
- Exploring Elastic Load Balancer
- Understanding Elastic Load Balancer Error Messages
- `Demo` Deploying an Elastic Load Balancer
- `Demo` Understanding Elastic Load Balancer CloudWatch Metrics
- `Demo` Working with Elastic Load Balancer Access Logs
- Understanding Sticky Sessions
- Load Balancing Based on an IP Address
- Discovering EC2 Image Builder
- `Demo` Creating an AMI Using EC2 Image Builder
- Introducing CloudFormation
- `Demo` Provisioning AWS Resources Using CloudFormation
- `HANDS-ON LAB` Deploying an EC2 Instance with CloudFormation
- Troubleshooting CloudFormation
- `Demo` CloudFormation Errors
- Introducing CloudFormation StackSets
- CloudFormation Best Practices
- Exploring Blue/Green Deployments
- Understanding Rolling Deployments
- When to Use Canary Deployments
- Automating Tasks Using AWS Systems Manager
- `Demo` Implementing Automated Patching Using AWS Systems Manager
- `Demo` Using AWS Systems Manager EC2 Run Command
- Section Review: Deployment, Provisioning, and Automation Summary - Part 1
- Section Review: Deployment, Provisioning, and Automation Summary - Part 2



<br><br>

## `Demo` Deploying an Elastic Compute Cloud (EC2) Instance

1. Launch an EC2 Instance
    - Explore the options available.
    - Configure the security group to allow HTTP traffic.
2. Use a Bootstrap Script
    - Install http and create /var/www/index.html.
    - Navigate to Advanced Option, and enter the following bootsrap script below:

        ```sh
        #!bin/bash
        dnf update -y
        dnf install httpd -y
        echo "<html><body><h1>Hello Cloud Gurus</h1></body></html>" > /var/www/html/index.html
        systemctl start httpd
        systemctl enable httpd
        ```
3. Test Our Website
    - Access the website using the public IP address.
      - Open `EC2>Instances>Instances`
      - Check box of created instance and view details
      - Copy Public IP and access resource in browser.


<br><br>

## Understanding EBS Volumes

### What Is EBS?
- Storage volumes that you can attach to your EC2 instance.
- When you create EC2 instance, it has at least one EBS volume attached, and that is where your OS gets installed.<br>You can add more volumes
- You can use EBS the same way you would use any system disk:
  - Create a file system
  - Run a database
  - Run an operating system
  - Store data
  - Install applications

<br>

### EBS Features
- **Mission Critical**
  1. **Production workloads**<br>Designed for mission critical worloads.
  2. **High Availability**<br>Automatically replicated within a single Availability Zone to protect against hardware failures.
  3. **Scalable**<br>Dynamically increase capacity and change the type volume with no downtime or performance impact to your live system. 

<br>

### EBS Volume Types - Solid State Disk
- **General Purpose SSD `gp2`**
  - A balance of price and performance.
  - 3 IOP per GiB, up to a maximum of 16,000 IOPS per volume.
  - gp2 volumes smaller than 1TB can burst up to 3,000 IOPS.
  - Good for boot volumes or development and test applications which are not latency sensitive.

<br>

- **General Purpose SSD `gp3`**
  - Baseline of 3,000 IOPS for **any volume size** (1GB - 16TB)
  - Delivering up to 16,000 IOPS
  - 20% cheaper than `gp2`
  - Like `gp2`, they are good for boot volumes or development and test applications which are not latency sensistive.

<br>

- **Provisioned IOPS SSD `io1`**
  - The high performance option, and the most expensive.
  - Up to 64,000 IOPS per volume. 50 IOPS per GiB.
  - Use if you need more than 16,000 IOPS.
  - Designed for I/O intensive applications, large databases, and latency-sensitive workloads.

<br>

- **Provisioned IOPS SSD `io2`**
  - Latest generation.
  - Higher durability and more IOPS.
  - Similar to `io1` it is up to the same maximum of 64,000 IOPS per volume.
  - `io2` is the same prive as `io1`.
  - `io2` is more durable and more performant.
  - Up to 64,000 IOPS per volume. 500 IOPS per GiB (10x more than `io1`)
  - `io2` offers 99.999% durability instead of up to 99.8-99.9% offered by all other EBS solutions.
  - I/O intensive apps, large databases, and latency-sensitive workloads. Applications which need high levels of durability.

<br>

- **Provisioned IOPS SSD `io2 Block Express`**
  - Relatively new offering from AWS.
  - SAN (Storage Area Network) in the cloud.
  - Highest performance, sub-millisecond latency.
  - Uses EBS Block Express architecture.
  - 4x throughput IOPS and capacity of regular `io2` volumes.
  - Up to 64TB, 256,000 IOPS per volume.
  - 99.999% durability.
  - Great for the largest, most critical, high-performance applications like **SAP HANA**, **Oracle**, **Microsoft SQL Server** and **IBM DB2**.

<br>

### EBS Volume Types - Hard Disk Drive (Mb/s-Intensive)

- **Throughput Optimized HDD `st1`**
  - Low-cost HDD VOlume.
  - Baseline throughput of 40 MB/s per TB.
  - Ability to burst up to 250 MB/s per TB.
  - Maximum throughput of 500 MB/s per volume.
  - Ideal for frequently-accessed, throughput-intensive workloads (i.e. Big Data, data warehouses, ETL and log processing)
  - A cost effective way to store mountains of data.
  - **Cannot be a boot volume**

<br>

- **Cold HDD `sc1`**
  - Lowest cost option.
  - Baseline throughput of 12 MB/s per TB.
  - Ability to burst up to 80 MB/s per TB.
  - Max throughput of 250 MB/s per volume.
  - A good choice for colder data requiring fewer scans per day.
  - Good for applications that need the lowest cost and performance is not a factor. 
  - **Cannot be a boot volume**

<br><br>

### IOPS vs Throughput

|**IOPS**|**Throughput**|
|---|---|
|Measure the number of read and write operations per second|Measures the number of bits read or written per second (MB/s)|
|Important metric for quick transactions, low latency apps, transactional workloads|Important metric for large datasets, large I/O sizes, complex queries|
|The ability to action reads and writes very quickly|The ability to deal with large datasets|
|Choose Provisioned IOPS SSD (`io1` or `io2`)|Chose Throughput Optimized HDD (`st1`)|


<br><br><br>

## What is a Bastion Host?

**Bastion Host** - a public-facing instannce which enables you to SSH or RDP to your private instance from an untrusted network.

![](img/2.3.BastionHost.png)

- A bastion host has a public IP address and is connected to the internet / untrusted network.
- It is security hardened with any unnecessary services removed to reduce the attack surface.
  
<br>

*Example scenario*
![](img/2.4.BastionHostExample.png)


<br><br><br>

## Exploring Elastic Load Balancer
A load balancer distributes network traffic across a group of servers.

![](img/2.5.ELBDiagram.png)

### Elastic Load Balancer Types:
- **Application Load Balancer**
  - HTTP/S
- **Network Load Balancer**
  - TCP and high performance option
- **Classic Load Balancer** (Legacy option)
  - HTTP/S and TCP
- **Gateway Load Balancer**
  - Allows you to load balance workloads for third-party virtual appliances wunning in AWS, such as:
    - Virtual applicances purchased using the AWS Marketplace
    - Virtual firewalls from companies like Fortiner, Palo Alto, Juniper, Cisco.
    - Intrusion detection or intrusion prevention (IDS/IPS) systems from companies like CheckPoint, Trend Micro, etc.

<br>

### 7 Layer OSI Model

|Layer|Functionality|
|**Layer 7**<br>Application| What the end user sees HTTP, web browser |
|**Layer 6**<br>Presentation| Data is in a usable format. Encryption, SSH |
|**Layer 5**<br>Session| Maintain connections and sessions |
|**Layer 4**<br>Transport| Transmit data using TPC and UDP |
|**Layer 3**<br>Network| Logically routes packets, based on IP address |
|**Layer 2**<br>Data Link| Physical transmits data based on MAC address |
|**Layer 1**<br>Physical| Transmits bits and bytes over physical devices |